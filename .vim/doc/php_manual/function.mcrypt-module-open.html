<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>使用するアルゴリズムおよびモードのモジュールをオープンする</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.mcrypt-module-is-block-mode.html">mcrypt_module_is_block_mode</a></div>
 <div class="next" style="float: right;"><a href="function.mcrypt-module-self-test.html">mcrypt_module_self_test</a></div>
 <div class="up"><a href="ref.mcrypt.html">mcrypt</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mcrypt-module-open" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">mcrypt_module_open</h1>
    <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5)</p><p class="refpurpose">mcrypt_module_open ― 
     使用するアルゴリズムおよびモードのモジュールをオープンする
    </p>

   </div>
   <div class="refsect1 u">
    <h3 class="title">説明</h3>
     <div class="methodsynopsis">
      <span class="type">resource</span> <span class="methodname"><b><b>mcrypt_module_open</b></b></span>
       ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$algorithm</tt></span>
      , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$algorithm_directory</tt></span>
      , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$mode</tt></span>
      , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$mode_directory</tt></span>
      )</div>

    <p class="para">
     この関数は、使用するアルゴリズムおよびモードのモジュールをオープン
     します。アルゴリズム名は、&quot;twofish&quot; または定数 MCRYPT_暗号名により
     algorithm で指定します。
     ライブラリは <a href="function.mcrypt-module-close.html" class="function">mcrypt_module_close()</a> をコールする
     ことによりクローズされます。通常、この関数は暗号化記述子を返し、
     エラーの際に <b><tt>FALSE</tt></b> を返します。
    </p>
    <p class="para">
     暗号化モジュールの位置を指定する際には
     <i><tt class="parameter">algorithm_directory</tt></i>
 および
     <i><tt class="parameter">mode_directory</tt></i>
 が使用されます。
     ディレクトリ名を指定した場合には、これが使用されます。
     これらの一つに空の文字列(&quot;&quot;)を指定した場合、ini ディエクティブの
     <i><tt class="parameter">mcrypt.algorithms_dir</tt></i>
 または
     <i><tt class="parameter">mcrypt.modes_dir</tt></i>
 に設定された値が使用されます。
     これらが設定されていない場合、libmcrypt をコンパイルした際の
     デフォルトのディレクトリ (通常は/usr/local/lib/libmcrypt)が
     使用されます。
    </p>
    <p class="para">
     <div class="example">
      <p><b>Example#1 <b>mcrypt_module_open()</b> の例</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #0000BB">MCRYPT_DES</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MCRYPT_MODE_ECB</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/usr/lib/mcrypt-modes'</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'rijndael-256'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ofb'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
    <p class="para">
     上の例の最初の行では、デフォルトのディレクトリから DES 暗号化を、
     そして <var class="filename">/usr/lib/mcrypt-modes</var> から EBC モードの
     オープンを試みます。2 行目の例では暗号化形式とモードを文字列で
     指定しています。これは、libmcrypt 2.4.x あるいは 2.5.x に対して
     拡張モジュールがリンクされている場合にのみ使用可能です。
    </p>
    <p class="para">
     <div class="example">
      <p><b>Example#2 <b>mcrypt_module_open()</b> を暗号化で使用する</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;暗号モジュールをオープンします&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'rijndael-256'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ofb'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;IV&nbsp;を作成し、キー長を定義します。Windows&nbsp;では、かわりに<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;MCRYPT_RAND&nbsp;を使用します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">MCRYPT_DEV_RANDOM</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ks&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_enc_get_key_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;キーを作成します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #DD0000">'very&nbsp;secret&nbsp;key'</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ks</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;暗号化処理を初期化します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;データを暗号化します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$encrypted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;very&nbsp;important&nbsp;data'</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;暗号化ハンドラを終了します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;復号化用の暗号モジュールを初期化します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;暗号化された文字列を復号します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$decrypted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mdecrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$encrypted</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;復号化ハンドルを終了し、モジュールを閉じます&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;文字列を表示します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">trim</span><span style="color: #007700">(</span><span style="color: #0000BB">$decrypted</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
    <p class="para">
     <a href="function.mcrypt-module-close.html" class="function">mcrypt_module_close()</a>、
     <a href="function.mcrypt-generic.html" class="function">mcrypt_generic()</a>、
     <a href="function.mdecrypt-generic.html" class="function">mdecrypt_generic()</a>、
     <a href="function.mcrypt-generic-init.html" class="function">mcrypt_generic_init()</a> および
     <a href="function.mcrypt-generic-deinit.html" class="function">mcrypt_generic_deinit()</a> も参照ください。
    </p>
   </div>

  </div><hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.mcrypt-module-is-block-mode.html">mcrypt_module_is_block_mode</a></div>
 <div class="next" style="float: right;"><a href="function.mcrypt-module-self-test.html">mcrypt_module_self_test</a></div>
 <div class="up"><a href="ref.mcrypt.html">mcrypt</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
