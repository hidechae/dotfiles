<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>XML パーサ関数</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.xdiff-string-patch.html">xdiff_string_patch</a></div>
 <div class="next" style="float: right;"><a href="function.utf8-decode.html">utf8_decode</a></div>
 <div class="up"><a href="funcref.html">関数リファレンス</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div>
  <h1 class="title">XML パーサ関数</h1>
  

  <div class="partintro">

   <div id="xml.intro" class="section">
    <h2 class="title">導入</h2>
    <p class="para">
     XML (eXtensible Markup Language) は、Web における構造化された
     ドキュメント交換用のデータフォーマットです。XML は、World Wide
     Web consortium (W3C) で規定された規格です。XML に関する情報およ
     び関連する技術は、<a href="http://www.w3.org/XML/" class="link external">&raquo; http://www.w3.org/XML/</a>
     で参照することができます。
    </p>
     <p class="para">
      このPHPエクステンションは、James Clark氏の
      <span class="productname">expat</span>のサポートをPHPに付加します。
      このツールキットは、XML ドキュメントの構文解析をしますが、
      検証は行いません。3種類のソース
      <a href="ref.xml.html#xml.encoding" class="link">文字エンコーディング</a>、
      <i class="literal">US-ASCII</i>,
      <i class="literal">ISO-8859-1</i> ,<i class="literal">UTF-8</i>
      がPHPでサポートされます。<i class="literal">UTF-16</i> はサポートさ
      れません。
     </p>
     <p class="para">
      この拡張モジュールは、<a href="function.xml-parser-create.html" class="link">XML パーサの作成</a>
      を行い、異なった XML イベントに関して<em class="emphasis">ハンドラ
      </em> を定義します。各XMLパーサーには、設定可能な小数の
      <a href="function.xml-parser-set-option.html" class="link">パラメータ</a>
      もあります。
     </p>
   </div>

   <div id="xml.requirements" class="section">
    <h2 class="title">要件</h2>
    <p class="para">
     このエクステンションは、<span class="productname">expat</span> を使用します。
     これは、<a href="http://www.jclark.com/xml/expat.html" class="link external">&raquo; http://www.jclark.com/xml/expat.html</a>にあります。
     expatに付属のMakefileは、デフォルトでライブラリを構築しません。こ
     れを行うmakeルールを次のように指定できます。
     <div class="example-contents">
<div class="cdata"><pre>
libexpat.a: $(OBJS)
    ar -rc $@ $(OBJS)
    ranlib $@
</pre></div>
     </div>

     expat のソース RPM パッケージが
     <a href="http://sourceforge.net/projects/expat/" class="link external">&raquo; http://sourceforge.net/projects/expat/</a> にあります。
    </p>
   </div>

   


<div id="xml.installation" class="section">
 <h2 class="title">インストール手順</h2>
 <p class="para">
  付属しているexpatライブラリを用いて以下の関数はデフォルトで有効となっ
  ています。
  <span class="option">--disable-xml</span>を指定してXMLサポート
  を無効にすることができます。Apache 1.3.9以降でモジュールとしてPHPを
  コンパイルする場合、PHPは、Apacheから自動的に付属する
  <span class="productname">expat</span>ライブラリを使用します。
  付属するexpatライブラリを使用したくない場合には、
  <span class="option">--with-expat-dir=DIR</span>を指定してPHP
  のconfigureを実行してください。ただし、DIRは、expatをインストールした
  ベースディレクトリです。
 </p>
 <p class="simpara">Windows 版の <i class="literal">PHP</i> には
この拡張モジュールのサポートが組み込まれています。これらの関数を使用
するために拡張モジュールを追加でロードする必要はありません。</p>
</div>





   <div id="xml.configuration" class="section">
    <h2 class="title">実行時設定</h2>
    <p class="para">設定ディレクティブは定義されていません。</p>
   </div>

   <div id="xml.resources" class="section">
    <h2 class="title">リソース型</h2>
    <div id="xml.resources.xml" class="section">
     <h2 class="title"><i class="literal">xml</i></h2>
     <p class="para">
      <a href="function.xml-parser-create.html" class="function">xml_parser_create()</a>および
      <a href="function.xml-parser-create-ns.html" class="function">xml_parser_create_ns()</a> により返された
      <i class="literal">xml</i>リソースは、
      このエクステンションにより提供された関数で使用される
      XMLパーサのインスタンスを参照します。
     </p>
    </div>
   </div>

   


<div id="xml.constants" class="section">
 <h2 class="title">定義済み定数</h2>
 <p class="simpara">
以下の定数が定義されています。
この関数の拡張モジュールが PHP 組み込みでコンパイルされているか、
実行時に動的にロードされている場合のみ使用可能です。
</p>
 <dl>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_NONE</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_NO_MEMORY</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_SYNTAX</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_NO_ELEMENTS</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_INVALID_TOKEN</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNCLOSED_TOKEN</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_PARTIAL_CHAR</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_TAG_MISMATCH</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_DUPLICATE_ATTRIBUTE</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_JUNK_AFTER_DOC_ELEMENT</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_PARAM_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNDEFINED_ENTITY</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_RECURSIVE_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_ASYNC_ENTITY</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_BAD_CHAR_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_BINARY_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_ATTRIBUTE_EXTERNAL_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_MISPLACED_XML_PI</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNKNOWN_ENCODING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_INCORRECT_ENCODING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNCLOSED_CDATA_SECTION</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_EXTERNAL_ENTITY_HANDLING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_CASE_FOLDING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_TARGET_ENCODING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_SKIP_TAGSTART</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_SKIP_WHITE</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

 </dl>

</div>





   <div id="xml.eventhandlers" class="section">
    <h2 class="title">イベントハンドラ</h2>
    <p class="para">
     XML イベントハンドラは次のように定義されます。
     <table border="5">
      <caption><b>サポートされる XML ハンドラ</b></caption>
      <colgroup>

       <thead valign="middle">
        <tr valign="middle">
         <th colspan="1">ハンドラ設定用の PHP 関数</th>
         <th colspan="1">イベントの説明</th>
        </tr>

       </thead>

       <tbody valign="middle">
        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left"><a href="function.xml-set-element-handler.html" class="function">xml_set_element_handler()</a></td>
         <td colspan="1" rowspan="1" align="left">
          要素イベントは、XML パーサーが開始または終了タグに出会うたび
          に発行されます。開始タグと終了タグについて別のハンドラがあり
          ます。
         </td>
        </tr>

        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left">
          <a href="function.xml-set-character-data-handler.html" class="function">xml_set_character_data_handler()</a>
         </td>
         <td colspan="1" rowspan="1" align="left">
          文字データは、タグの間の空白を含めて XML ドキュメントにおけ
          るほぼ全ての非マークアップ部分の内容です。XML パーサーは、
          空白を加えたり削除したりしないことに注意してください。空白が
          意味を有するかどうかを決めるのは、アプリケーション側の責任
          です。
         </td>
        </tr>

        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left">
          <a href="function.xml-set-processing-instruction-handler.html" class="function">xml_set_processing_instruction_handler()</a>
         </td>
         <td colspan="1" rowspan="1" align="left">
          PHP プログラマは、既に処理用命令 (PI) に既に慣れているに違
          いありません。&lt;?php ?&gt; は処理用命令であり、この場合、
          <span class="replaceable">php</span> は &quot;PI ターゲット&quot;と呼ばれます。
          これらの処理はアプリケーション依存ですが、全ての PI ターゲッ
          トが &quot;XML&quot; から始まることだけは、規定されています。
         </td>
        </tr>

        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left"><a href="function.xml-set-default-handler.html" class="function">xml_set_default_handler()</a></td>
         <td colspan="1" rowspan="1" align="left">
          別のハンドラでしないことをデフォルトのハンドラで行います。
          XML およびドキュメント型の宣言のようなことをデフォルトハンドラで
          行います。
         </td>
        </tr>

        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left">
          <a href="function.xml-set-unparsed-entity-decl-handler.html" class="function">xml_set_unparsed_entity_decl_handler()</a>
         </td>
         <td colspan="1" rowspan="1" align="left">
          このハンドラは、処理されない (NDATA) エンティティの宣言用に
          コールされます。
         </td>
        </tr>

        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left"><a href="function.xml-set-notation-decl-handler.html" class="function">xml_set_notation_decl_handler()</a></td>
         <td colspan="1" rowspan="1" align="left">
          このハンドラは、表記の宣言用にコールされます。
         </td>
        </tr>

        <tr valign="middle">
         <td colspan="1" rowspan="1" align="left">
          <a href="function.xml-set-external-entity-ref-handler.html" class="function">xml_set_external_entity_ref_handler()</a>
         </td>
         <td colspan="1" rowspan="1" align="left">
          このハンドラは、XML パーサーが外部処理された通常のエンティティ
          への参照を見つけた際にコールされます。これは、例えば、ファ
          イルまたは URL への参照とすることが可能です。例としては、
          <a href="ref.xml.html#example.xml-external-entity" class="link">外部エンティティ
     の例</a> を参照ください。
         </td>
        </tr>

       </tbody>
      </colgroup>

     </table>

    </p>
   </div>

   <div id="xml.case-folding" class="section">
    <h2 class="title">大文字変換(Case Folding)</h2>
     <p class="para">
     要素ハンドラ関数は、その要素に<span class="glossterm">大文字小文字を変換する
      (case-folded)</span>の名前をつけることができます。
     大文字変換(case-folding) は、XML標準により &quot;大文字でないものは等
     価な大文字に置換される一連の文字に適用されるプロセス&quot; として定義
     されています。言い替えると、XML に関しては単に大文字変換は大文字
     にすることを意味します。
    </p>
    <p class="para">
     デフォルトで、ハンドラ関数に渡される全ての要素名は、大文字変換さ
     れます。この動作は、<a href="function.xml-parser-get-option.html" class="function">xml_parser_get_option()</a>
     および<a href="function.xml-parser-set-option.html" class="function">xml_parser_set_option()</a> 関数でXMLパーサー
     毎にそれぞれ問い合わせ、制御することが可能です。
    </p>
   </div>

   <div id="xml.error-codes" class="section">
    <h2 class="title">エラーコード</h2>
    <p class="para">
     (<a href="function.xml-parse.html" class="function">xml_parse()</a> により返されるものとして)
     XMLエラーコードとして次のような定数が定義されています。:
     <ul class="simplelist">
      <li class="member">XML_ERROR_NONE</li>
      <li class="member">XML_ERROR_NO_MEMORY</li>
      <li class="member">XML_ERROR_SYNTAX</li>
      <li class="member">XML_ERROR_NO_ELEMENTS</li>
      <li class="member">XML_ERROR_INVALID_TOKEN</li>
      <li class="member">XML_ERROR_UNCLOSED_TOKEN</li>
      <li class="member">XML_ERROR_PARTIAL_CHAR</li>
      <li class="member">XML_ERROR_TAG_MISMATCH</li>
      <li class="member">XML_ERROR_DUPLICATE_ATTRIBUTE</li>
      <li class="member">XML_ERROR_JUNK_AFTER_DOC_ELEMENT</li>
      <li class="member">XML_ERROR_PARAM_ENTITY_REF</li>
      <li class="member">XML_ERROR_UNDEFINED_ENTITY</li>
      <li class="member">XML_ERROR_RECURSIVE_ENTITY_REF</li>
      <li class="member">XML_ERROR_ASYNC_ENTITY</li>
      <li class="member">XML_ERROR_BAD_CHAR_REF</li>
      <li class="member">XML_ERROR_BINARY_ENTITY_REF</li>
      <li class="member">XML_ERROR_ATTRIBUTE_EXTERNAL_ENTITY_REF</li>
      <li class="member">XML_ERROR_MISPLACED_XML_PI</li>
      <li class="member">XML_ERROR_UNKNOWN_ENCODING</li>
      <li class="member">XML_ERROR_INCORRECT_ENCODING</li>
      <li class="member">XML_ERROR_UNCLOSED_CDATA_SECTION</li>
      <li class="member">XML_ERROR_EXTERNAL_ENTITY_HANDLING</li>
     </ul>
    </p>
   </div>

   <div id="xml.encoding" class="section">
    <h2 class="title">文字エンコーディング</h2>
    <p class="para">
     PHPのXML拡張機能は、異なった<span class="glossterm">文字エンコーディング
     </span>を通じて<a href="http://www.unicode.org/" class="link external">&raquo; Unicode</a>
     文字セットをサポートします。<span class="glossterm">ソースエンコーディング
     </span>および<span class="glossterm">ターゲットエンコーディング
     </span>という2種類の文字エンコーディングがあります。
     PHP におけるドキュメントの内部表現は、常に
     <i class="literal">UTF-8</i>でエンコードされます。
    </p>
    <p class="para">
     ソースエンコーディングは、XMLドキュメントが
     <a href="function.xml-parse.html" class="link">構文解析</a>された際に行わ
     れます。<a href="function.xml-parser-create.html" class="link">XML パーサの
      作成</a>を行う際に、ソースエンコードを指定することができます。
     (このエンコーディングは、その XML パーサーが存在する間、後で変更す
     ることはできません)サポートされるソースエンコーディングは、
     <i class="literal">ISO-8859-1</i>, <i class="literal">US-ASCII</i> ,
     <i class="literal">UTF-8</i> です。前の二つは、シングルバイトエンコー
     ディングです。これは、各文字がシングルバイトで表現されることを意
     味します。<i class="literal">UTF-8</i> は、1から4バイトの可変ビット
     数(最大21ビット)で構成された文字をエンコードすることが可能です。
     PHP で用いられるデフォルトのソースエンコーディングは、
     <i class="literal">ISO-8859-1</i>です。
    </p>
    <p class="para">
     ターゲットエンコーディングは、PHPがデータをXMLハンドラ関数に
     渡す時に行われます。あるXMLパーサが作成された際、ターゲットエン
     コーディングは、ソースエンコーディングと同様に設定されます。
     しかし、これは、いつでも変更可能です。ターゲットエンコーディング
     は、タグ名と同様に文字データに作用し、命令を処理します。
    </p>
    <p class="para">
     XML パーサがソースエンコーディングが表現できる範囲の外側の文字に
     出会った場合、エラーが返されます。
    </p>
    <p class="para">
     解釈するXMLドキュメントにおいてPHPが文字に出会った際に、選択した
     ターゲットエンコーディングで表現できない文字に出会った場合、問題
     の文字は &quot;降格&quot; されます。現在、このことはこのような文字が疑問符
     で置換されることを意味します。
    </p>
   </div>

   <div id="xml.examples" class="section">
    <h2 class="title">例</h2>
    <p class="para">
     以下にXMLドキュメントを処理するPHPスクリプトの例をいくつか示します。
    </p>
    <div id="example.xml-structure" class="section">
     <h2 class="title">XML エレメント構造の例</h2>
     <p class="para">
      この最初の例は、あるドキュメント中のstart エレメントの構造をイン
      デントを付けて表示します。
      <div class="example">
       <p><b>Example#1 XML エレメント構造を表示</b></p>
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"data.xml"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$depth&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><br />function&nbsp;</span><span style="color: #0000BB">startElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attrs</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">];&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&nbsp;&nbsp;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"$name\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">]++;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">endElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">]--;<br />}<br /><br /></span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"startElement"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"endElement"</span><span style="color: #007700">);<br />if&nbsp;(!(</span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"XML&nbsp;入力をオープンできませんでした"</span><span style="color: #007700">);<br />}<br />while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;エラー:&nbsp;%s&nbsp;が&nbsp;%d&nbsp;行目で発生しました"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
       </div>

      </div>
     </p>
    </div>

    <div id="example.xml-map-tags" class="section">
     <h2 class="title">XMLタグのマッピングの例</h2>
     <p class="para">
      <div class="example">
       <p><b>Example#2 XMLをHTMLにマップする</b></p>
       <div class="example-contents"><p>
  この例は、XMLドキュメントのタグを直接HTMLタグにマップします。
  &quot;map array&quot; にないエレメントは無視されます。もちろん、この例は、
  特定の XML ドキュメント型を有する場合のみ動作します。
       </p></div>
       <div class="example-contents"><p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"data.xml"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$map_array&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"BOLD"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"B"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"EMPHASIS"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"I"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"LITERAL"&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"TT"<br /></span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">startElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attrs</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">[</span><span style="color: #0000BB">$name</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;$map_array[$name]&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">endElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">[</span><span style="color: #0000BB">$name</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/$map_array[$name]&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">characterData</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;case-folding&nbsp;を用いることで、$map_array&nbsp;から確実にタグを見つけられるようにします<br /></span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"startElement"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"endElement"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">xml_set_character_data_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"characterData"</span><span style="color: #007700">);<br />if&nbsp;(!(</span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"XML&nbsp;入力をオープンできませんでした"</span><span style="color: #007700">);<br />}<br /><br />while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;エラー:&nbsp;%s&nbsp;が&nbsp;%d&nbsp;行目で発生しました"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

       </p></div>
      </div>
     </p>
    </div>

    <div id="example.xml-external-entity" class="section">
     <h2 class="title">XML 外部エンティティの例</h2>
     <p class="para">
      この例は、XML コードに焦点を当てます。この例は、他のドキュメント
      をインクルードし処理するための外部エンティティリファレンスのハン
      ドラの使用法およびPIの処理方法、PIが含むコードに関する&quot;信頼度&quot;
      を定義する手段を説明します。
     </p>
     <p class="para">
      この例で使用される XML ドキュメントは、例題ファイル
      (<var class="filename">xmltest.xml</var> および
      <var class="filename">xmltest2.xml</var>) にあります。
     </p>
     <p class="para">
      <div class="example">
       <p><b>Example#3 外部エンティティの例</b></p>
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"xmltest.xml"</span><span style="color: #007700">;<br /><br />function&nbsp;</span><span style="color: #0000BB">trustedFile</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;信頼できるのは、自分自身が所有しているローカルファイルのみです<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">eregi</span><span style="color: #007700">(</span><span style="color: #DD0000">"^([a-z]+)://"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">fileowner</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">getmyuid</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">startElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attribs</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&amp;lt;&lt;font&nbsp;color=\"#0000cc\"&gt;$name&lt;/font&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribs</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$attribs&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&nbsp;&lt;font&nbsp;color=\"#009900\"&gt;$k&lt;/font&gt;=\"&lt;font<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color=\"#990000\"&gt;$v&lt;/font&gt;\""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&amp;gt;"</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">endElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&amp;lt;/&lt;font&nbsp;color=\"#0000cc\"&gt;$name&lt;/font&gt;&amp;gt;"</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">characterData</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;$data&lt;/b&gt;"</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">PIHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$target</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$target</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">"php"</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;もし「信頼できる」ドキュメントだった場合、その中に書かれている<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;PHP&nbsp;コードを実行しても安全だと考えます。そうでない場合、<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;コードを実行するかわりにコードそのものを表示します。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">trustedFile</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"信頼できない&nbsp;PHP&nbsp;コード:&nbsp;&lt;i&gt;%s&lt;/i&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">defaultHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">"&amp;"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">";"</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">'&lt;font&nbsp;color="#aa00aa"&gt;%s&lt;/font&gt;'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">'&lt;font&nbsp;size="-1"&gt;%s&lt;/font&gt;'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">externalEntityRefHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$openEntityNames</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$base</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$publicId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!list(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">new_xml_parser</span><span style="color: #007700">(</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"エンティティ&nbsp;%s&nbsp;(%s&nbsp;にある)&nbsp;をオープンできませんでした\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$openEntityNames</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;エラー:&nbsp;%s&nbsp;が、%d&nbsp;行目でエンティティ&nbsp;%s&nbsp;のパース中に発生しました\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">$openEntityNames</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">new_xml_parser</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"startElement"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"endElement"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_character_data_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"characterData"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_processing_instruction_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"PIHandler"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_default_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"defaultHandler"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_external_entity_ref_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"externalEntityRefHandler"</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(</span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">settype</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"array"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">[</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />}<br /><br />if&nbsp;(!(list(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">new_xml_parser</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"XML&nbsp;入力をオープンできませんでした"</span><span style="color: #007700">);<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">"&lt;pre&gt;"</span><span style="color: #007700">;<br />while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;エラー:&nbsp;%s&nbsp;が&nbsp;%d&nbsp;行目で発生しました\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/pre&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"パースが完了しました\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

      </div>
     </p>
     <p class="para">
      <div class="example">
       <p><b>Example#4 xmltest.xml</b></p>
       <div class="example-contents">
<div class="cdata"><pre>
&lt;?xml version=&#039;1.0&#039;?&gt;
&lt;!DOCTYPE chapter SYSTEM &quot;/just/a/test.dtd&quot; [
&lt;!ENTITY plainEntity &quot;FOO entity&quot;&gt;
&lt;!ENTITY systemEntity SYSTEM &quot;xmltest2.xml&quot;&gt;
]&gt;
&lt;chapter&gt;
 &lt;TITLE&gt;Title &amp;plainEntity;&lt;/TITLE&gt;
 &lt;para&gt;
  &lt;informaltable&gt;
   &lt;tgroup cols=&quot;3&quot;&gt;
    &lt;tbody&gt;
     &lt;row&gt;&lt;entry&gt;a1&lt;/entry&gt;&lt;entry morerows=&quot;1&quot;&gt;b1&lt;/entry&gt;&lt;entry&gt;c1&lt;/entry&gt;&lt;/row&gt;
     &lt;row&gt;&lt;entry&gt;a2&lt;/entry&gt;&lt;entry&gt;c2&lt;/entry&gt;&lt;/row&gt;
     &lt;row&gt;&lt;entry&gt;a3&lt;/entry&gt;&lt;entry&gt;b3&lt;/entry&gt;&lt;entry&gt;c3&lt;/entry&gt;&lt;/row&gt;
    &lt;/tbody&gt;
   &lt;/tgroup&gt;
  &lt;/informaltable&gt;
 &lt;/para&gt;
 &amp;systemEntity;
 &lt;section id=&quot;about&quot;&gt;
  &lt;title&gt;About this Document&lt;/title&gt;
  &lt;para&gt;
   &lt;!-- this is a comment --&gt;
   &lt;?php print &#039;Hi!  This is PHP version &#039;.phpversion(); ?&gt;
  &lt;/para&gt;
 &lt;/section&gt;
&lt;/chapter&gt;
</pre></div>
       </div>

      </div>
     </p>
     <p class="para">
      このファイルは、<var class="filename">xmltest.xml</var> からインクルードされます。
      <div class="example">
       <p><b>Example#5 xmltest2.xml</b></p>
       <div class="example-contents">
<div class="cdata"><pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE foo [
&lt;!ENTITY testEnt &quot;test entity&quot;&gt;
]&gt;
&lt;foo&gt;
   &lt;element attrib=&quot;value&quot;/&gt;
   &amp;testEnt;
   &lt;?php print &quot;This is some more PHP code being executed.&quot;; ?&gt;
&lt;/foo&gt;
</pre></div>
       </div>

      </div>
     </p>
    </div>
   </div>
  </div>











































































































































































 <h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.utf8-decode.html">utf8_decode</a> ― UTF-8 エンコードされた ISO-8859-1 文字列をシングルバイトの ISO-8859-1 に変換する</li><li><a href="function.utf8-encode.html">utf8_encode</a> ― ISO-8859-1 文字列を UTF-8 にエンコードする</li><li><a href="function.xml-error-string.html">xml_error_string</a> ― XML パーサのエラー文字列を得る</li><li><a href="function.xml-get-current-byte-index.html">xml_get_current_byte_index</a> ― XML パーサのカレントのバイトインデックスを得る</li><li><a href="function.xml-get-current-column-number.html">xml_get_current_column_number</a> ― XML パーサのカレントのカラム番号を取得する</li><li><a href="function.xml-get-current-line-number.html">xml_get_current_line_number</a> ― XML パーサのカレントの行番号を得る</li><li><a href="function.xml-get-error-code.html">xml_get_error_code</a> ― XML パーサのエラーコードを得る</li><li><a href="function.xml-parse-into-struct.html">xml_parse_into_struct</a> ― 配列構造体に XML データを処理する</li><li><a href="function.xml-parse.html">xml_parse</a> ― XML ドキュメントの処理を開始する</li><li><a href="function.xml-parser-create-ns.html">xml_parser_create_ns</a> ― 名前空間をサポートした XML パーサを生成する</li><li><a href="function.xml-parser-create.html">xml_parser_create</a> ― XML パーサを作成する</li><li><a href="function.xml-parser-free.html">xml_parser_free</a> ― XML パーサを解放する</li><li><a href="function.xml-parser-get-option.html">xml_parser_get_option</a> ― XML パーサからオプションを得る</li><li><a href="function.xml-parser-set-option.html">xml_parser_set_option</a> ― XML パーサのオプションを設定する</li><li><a href="function.xml-set-character-data-handler.html">xml_set_character_data_handler</a> ― 文字データハンドラを設定する</li><li><a href="function.xml-set-default-handler.html">xml_set_default_handler</a> ― デフォルトのハンドラを設定する</li><li><a href="function.xml-set-element-handler.html">xml_set_element_handler</a> ― 開始要素および終了要素のハンドラを設定する</li><li><a href="function.xml-set-end-namespace-decl-handler.html">xml_set_end_namespace_decl_handler</a> ― 名前空間終了ハンドラを設定する</li><li><a href="function.xml-set-external-entity-ref-handler.html">xml_set_external_entity_ref_handler</a> ― 外部エンティティリファレンスハンドラを設定する</li><li><a href="function.xml-set-notation-decl-handler.html">xml_set_notation_decl_handler</a> ― 表記法宣言ハンドラを設定する</li><li><a href="function.xml-set-object.html">xml_set_object</a> ― オブジェクト内部で XML パーサを使用する</li><li><a href="function.xml-set-processing-instruction-handler.html">xml_set_processing_instruction_handler</a> ― 処理命令 (PI) 用ハンドラを設定する</li><li><a href="function.xml-set-start-namespace-decl-handler.html">xml_set_start_namespace_decl_handler</a> ― 名前空間開始ハンドラを設定する</li><li><a href="function.xml-set-unparsed-entity-decl-handler.html">xml_set_unparsed_entity_decl_handler</a> ― 処理されないエンティティ宣言用ハンドラを設定する</li></ul>
</div>
<hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.xdiff-string-patch.html">xdiff_string_patch</a></div>
 <div class="next" style="float: right;"><a href="function.utf8-decode.html">utf8_decode</a></div>
 <div class="up"><a href="funcref.html">関数リファレンス</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
