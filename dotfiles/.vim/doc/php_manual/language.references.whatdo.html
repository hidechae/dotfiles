<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>リファレンスが行うことは何ですか?</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="language.references.html">リファレンスの説明</a></div>
 <div class="next" style="float: right;"><a href="language.references.arent.html">リファレンスが行わないこと</a></div>
 <div class="up"><a href="language.references.html">リファレンスの説明</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="language.references.whatdo" class="sect1">
   <h2 class="title">リファレンスが行うことは何ですか?</h2>
   <p class="para">
    PHP のリファレンスにより二つの変数が同じ内容を参照することが可能です。
    つまり、以下のようなものを実行した場合です。
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$a&nbsp;</span><span style="color: #007700">=&amp;&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
    この場合、<var class="varname">$a</var> と <var class="varname">$b</var> は同じ内容を
    指します。
    <blockquote><p><b class="note">注意</b>: 
     
      ここで、<var class="varname">$a</var> と <var class="varname">$b</var> は完全に
      同じで、<var class="varname">$a</var> が <var class="varname">$b</var> を
      指しているわけではなく、その逆でもありません。<var class="varname">$a</var> と
      <var class="varname">$b</var> は同じ場所を指しているのです。
     <br />
    </p></blockquote>
   </p>
   <blockquote><p><b class="note">注意</b>: 
    
     リファレンスを含む配列をコピーする際に、そのリファレンスが解消される
     ことはありません。配列を関数に値渡しする場合も同様です。
    <br />
   </p></blockquote>
   <blockquote><p><b class="note">注意</b>: 
    
    未定義の変数のリファレンスに対して代入したり
    渡したり返したりすると、そこで変数が作成されます。
     <div class="example">
      <p><b>Example#1 未定義の変数のリファレンスの使用</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$var</span><span style="color: #007700">)&nbsp;{&nbsp;}<br /><br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;$a&nbsp;が作成され、null&nbsp;が代入されます<br /><br /></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">[</span><span style="color: #DD0000">'b'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'b'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">));&nbsp;</span><span style="color: #FF8000">//&nbsp;bool(true)<br /><br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">StdClass</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">d</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">property_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'d'</span><span style="color: #007700">));&nbsp;</span><span style="color: #FF8000">//&nbsp;bool(true)<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    <br />
   </p></blockquote>
   <p class="para">
    リファレンスを返す関数や <i class="literal">new</i> 演算子でも
    同じ構文が使用可能です（PHP 4.0.4 以降）。
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$bar&nbsp;</span><span style="color: #007700">=&amp;&nbsp;new&nbsp;</span><span style="color: #0000BB">fooclass</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$foo&nbsp;</span><span style="color: #007700">=&amp;&nbsp;</span><span style="color: #0000BB">find_var</span><span style="color: #007700">(</span><span style="color: #0000BB">$bar</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
    PHP 5 以降、<a href="language.oop5.basic.html#language.oop5.basic.new" class="link">new</a>
    は自動的にリファレンスを返すようになりました。そのため、この場面で
    <i class="literal">=&amp;</i> を使用することは非推奨となり、
    E_STRICT レベルのメッセージが表示されるようになりました。
   </p>
    <blockquote><p><b class="note">注意</b>: 
     
     <i class="literal">&amp;</i> 演算子を使用しない場合は、オブジェクトのコピーが
     作成されます。クラスの内部で <i class="literal">$this</i> を使用した場合、
     それはクラスの現在のインスタンスに対する操作を表します。
     <i class="literal">&amp;</i> のない代入はインスタンス（オブジェクト）のコピーを
     行い、<i class="literal">$this</i> はそのコピーに対する操作を表します。
     これはお望みの動作と異なるかもしれません。パフォーマンスやメモリ使用量の
     観点から、常に単一のインスタンスに対して操作を行いたくなることもあるでしょう。
     <br />
     
      コンストラクタ内で <i class="literal">@new</i> のようにして
      <i class="literal">@</i> 演算子を使用すると、あらゆるエラーの表示を
      <em class="emphasis">見えなくする</em>ことが可能ですが、
      <i class="literal">&amp;new</i> を使用する場合にはこの機能は動作しません。
      Zend Engine の仕様により、これはパースエラーとなります。
     <br />
   </p></blockquote>
   <div class="warning"><b class="warning">警告</b>
    <p class="para">
     関数の内部で <i class="literal">global</i> 宣言された変数にリファレンスを
     代入すると、そのリファレンスは関数の内部でのみ参照可能となります。
     これを避けるには、<var class="varname">$GLOBALS</var> 配列を使用します。
     <div class="example">
      <p><b>Example#2 関数内でのグローバル変数の参照</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$var1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Example&nbsp;variable"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$var2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><br />function&nbsp;</span><span style="color: #0000BB">global_references</span><span style="color: #007700">(</span><span style="color: #0000BB">$use_globals</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$var1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$var2</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$use_globals</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$var2&nbsp;</span><span style="color: #007700">=&amp;&nbsp;</span><span style="color: #0000BB">$var1</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;関数の内部でのみ参照可能<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #DD0000">"var2"</span><span style="color: #007700">]&nbsp;=&amp;&nbsp;</span><span style="color: #0000BB">$var1</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;関数の外部でも参照可能<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br /><br /></span><span style="color: #0000BB">global_references</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"var2&nbsp;の値は&nbsp;'$var2'\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;var2&nbsp;の値は&nbsp;''<br /></span><span style="color: #0000BB">global_references</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"var2&nbsp;の値は&nbsp;'$var2'\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;var2&nbsp;の値は&nbsp;'Example&nbsp;variable'<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
     <i class="literal">global $var;</i> は、<i class="literal">$var
     =&amp; $GLOBALS[&#039;var&#039;];</i> の短縮版だと考えてください。
     これにより、他のリファレンスを <i class="literal">$var</i> に代入し、
     ローカル変数のリファレンスのみを変更します。
    </p>
   </div>
   <blockquote><p><b class="note">注意</b>: 
    
     <a href="control-structures.foreach.html" class="link">foreach</a> ステートメント
     の内部でリファレンス変数に値を代入すると、リファレンスも変更されます。
     <div class="example">
      <p><b>Example#3 リファレンスと foreach ステートメント</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$ref&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&amp;&nbsp;</span><span style="color: #0000BB">$ref</span><span style="color: #007700">;<br />foreach&nbsp;(array(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;何かを実行します<br /></span><span style="color: #007700">}<br />echo&nbsp;</span><span style="color: #0000BB">$ref</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;3&nbsp;-&nbsp;配列の最後の要素<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    <br />
   </p></blockquote>
   <p class="para">
    リファレンスの第 2 の使用法は、変数のリファレンス渡しです。この場合、
    関数でローカル変数が作成され、コール側の変数が、それと同じ内容への
    リファレンスとなります。例を示します。
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$var</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$var</span><span style="color: #007700">++;<br />}<br /><br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">=</span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
    この結果、<var class="varname">$a</var> は 6 となります。これは、関数
    <var class="varname">foo</var> の中では、変数 <var class="varname">$var</var> は
    <var class="varname">$a</var> と同じ内容を指しているためです。
    より詳細な説明は、
    <a href="language.references.pass.html" class="link">リファレンス渡し</a>
    を参照ください。
   </p>
   <p class="simpara">
    リファレンスの第 3 の使用法は、
    <a href="language.references.return.html" class="link">リファレンスによる返り値
    </a>です。
   </p>
  </div><hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="language.references.html">リファレンスの説明</a></div>
 <div class="next" style="float: right;"><a href="language.references.arent.html">リファレンスが行わないこと</a></div>
 <div class="up"><a href="language.references.html">リファレンスの説明</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
