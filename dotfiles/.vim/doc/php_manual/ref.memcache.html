<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>Memcache 関数</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.m-verifysslcert.html">m_verifysslcert</a></div>
 <div class="next" style="float: right;"><a href="function.Memcache-add.html">Memcache::add</a></div>
 <div class="up"><a href="funcref.html">関数リファレンス</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div>
  <h1 class="title">Memcache 関数</h1>
  

  <div class="partintro">
   <div id="memcache.intro" class="section">
    <h2 class="title">導入</h2>
    <p class="para">
     Memcache モジュールは、memcached に対する手続き型および
     オブジェクト指向のインターフェイスを提供します。これは非常に効率的な
     キャッシュデーモンで、動的な web アプリケーションでの
     データベースの読み込み量を減らすように設計されています。
    </p>
    <p class="para">
     Memcache モジュールは、<a href="ref.session.html" class="link">セッション</a> ハンドラ (<i class="literal">memcache</i>)
     も提供します。
    </p>
    <p class="para">
     memcached についてのより詳細な情報は <a href="http://www.danga.com/memcached/" class="link external">&raquo; http://www.danga.com/memcached/</a> にあります。
    </p>
   </div>

   <div id="memcache.requirements" class="section">
    <h2 class="title">要件</h2>
    <p class="para">
     このモジュールは、その場でのデータ圧縮機能をサポートするために
     <a href="http://www.zlib.net/" class="link external">&raquo; zlib</a> の関数を使用しています。
     このモジュールをインストールするには Zlib が必要となります。
    </p>
    <p class="para">
     memcache 拡張モジュールを使用するには、PHP 4.3.3 以降が必要です。
    </p>
   </div>

   


<div id="memcache.installation" class="section">
 <h2 class="title">インストール手順</h2>
 <p class="para">
  この <a href="http://pecl.php.net/" class="link external">&raquo; PECL</a> 拡張
モジュールは PHP にバンドルされていません。
  この PECL 拡張モジュールをインストールする方法は、
マニュアルの <a href="install.pecl.html" class="link">
PECL 拡張モジュールのインストール</a> という章にあります。
新規リリース・ダウンロード・ソースファイル・管理者情報・CHANGELOG
といった関連する情報については、次の場所にあります。
  <a href="http://pecl.php.net/package/memcache" class="link external">&raquo; http://pecl.php.net/package/memcache</a>.
 </p>
 <p class="para">
  これらの関数を使用するには、
  <span class="option">--enable-memcache[=DIR]</span> オプションを
  指定し、Memcache のサポートを有効にして PHP をコンパイルする必要があります。
  オプションで、memcache セッションハンドラのサポートを無効にすることもできます。
  その場合は <span class="option">--disable-memcache-session</span> を指定します。
 </p>
 <p class="para">
  Windows ユーザがこれらの関数を使用するには、<var class="filename">php.ini</var> の中で
  <var class="filename">php_memcache.dll</var> を有効にします。
  
この <acronym title="PHP Extension and Application Repository">PECL</acronym> 拡張モジュール用の <acronym title="Dynamic Link Library">DLL</acronym>
は、<a href="http://www.php.net/downloads.php" class="link external">&raquo; PHP のダウンロード</a> ページあるいは
<a href="http://pecl4win.php.net/" class="link external">&raquo; http://pecl4win.php.net/</a> からダウンロードできます。
 </p>
</div>



   


<div id="memcache.ini" class="section">
 <h2 class="title">実行時設定</h2>
 <p class="simpara">
<var class="filename">php.ini</var> の設定により動作が変化します。
</p>
 <p class="para">
  <table border="5">
   <caption><b>Memcache 設定オプション</b></caption>
   <colgroup>

    <thead valign="middle">
     <tr valign="middle">
      <th colspan="1">名前</th>
      <th colspan="1">デフォルト</th>
      <th colspan="1">変更の可否</th>
      <th colspan="1">変更履歴</th>
     </tr>

    </thead>

    <tbody valign="middle">
     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">memcache.allow_failover</td>
      <td colspan="1" rowspan="1" align="left">&quot;1&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.0.2 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">memcache.max_failover_attempts</td>
      <td colspan="1" rowspan="1" align="left">&quot;20&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.1.0 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">memcache.chunk_size</td>
      <td colspan="1" rowspan="1" align="left">&quot;8192&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.0.2 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">memcache.default_port</td>
      <td colspan="1" rowspan="1" align="left">&quot;11211&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.0.2 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">memcache.hash_strategy</td>
      <td colspan="1" rowspan="1" align="left">&quot;standard&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.2.0 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">memcache.hash_function</td>
      <td colspan="1" rowspan="1" align="left">&quot;crc32&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.2.0 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">session.save_handler</td>
      <td colspan="1" rowspan="1" align="left">&quot;files&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.1.2 以降で使用可能です</td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">session.save_path</td>
      <td colspan="1" rowspan="1" align="left">&quot;&quot;</td>
      <td colspan="1" rowspan="1" align="left">PHP_INI_ALL</td>
      <td colspan="1" rowspan="1" align="left">memcache 2.1.2 以降で使用可能です</td>
     </tr>

    </tbody>
   </colgroup>

  </table>

  PHP_INI_* 定数の詳細および定義については
<a href="ini.html" class="xref">php.ini ディレクティブ</a> を参照してください。
 </p>

<p class="para">以下に設定ディレクティブに関する
簡単な説明を示します。</p>

<p class="para">
 <dl>

  
  <dt id="ini.memcache.allow-failover">
   <span class="term">
    <i><tt class="parameter">memcache.allow_failover</tt></i>

    <a href="language.types.boolean.html" class="type boolean">boolean</a>
   </span>
   <dd>

    <p class="para">
     エラー時に、透過的なフェイルオーバーを行うかどうかを指定します。
    </p>
   </dd>

  </dt>

  
  <dt id="ini.memcache.max-failover-attempts">
   <span class="term">
    <i><tt class="parameter">memcache.max_failover_attempts</tt></i>

    <a href="language.types.integer.html" class="type integer">integer</a>
   </span>
   <dd>

    <p class="para">
     データの設定や取得を試みるサーバの数を指定します。
     memcache.allow_failover を指定した場合にのみ使用します。
    </p>
   </dd>

  </dt>

  
  <dt id="ini.memcache.chunk-size">
   <span class="term">
    <i><tt class="parameter">memcache.chunk_size</tt></i>

    <a href="language.types.integer.html" class="type integer">integer</a>
   </span>
   <dd>

    <p class="para">
     データは、ここで指定した大きさに分割されます。
     この値を小さくすると、ネットワークに対する書き込みが多くなります。
     不可解な速度低下が発生する場合は、この値を
     32768 まで大きくしてください。
    </p>
   </dd>

  </dt>

  
  <dt id="ini.memcache.default-port">
   <span class="term">
    <i><tt class="parameter">memcache.default_port</tt></i>

    <a href="language.types.string.html" class="type string">string</a>
   </span>
   <dd>

    <p class="para">
     memcached サーバに接続する際に、
     デフォルトで使用される TCP ポート番号。
    </p>
   </dd>

  </dt>


  <dt id="ini.memcache.hash-strategy">
   <span class="term">
    <i><tt class="parameter">memcache.hash_strategy</tt></i>

    <a href="language.types.string.html" class="type string">string</a>
   </span>
   <dd>

    <p class="para">
     キーをサーバと関連づけるために使用する方式を制御します。この値を
     <i class="literal">consistent</i> にすると、一貫したハッシュを使用します。
     これにより、サーバを追加したり削除したりした際にキーの再マッピングの必要がなくなります。
     この値を <i class="literal">standard</i> にすると、以前の方法を使用します。
    </p>
   </dd>

  </dt>

  
  <dt id="ini.memcache.hash-function">
   <span class="term">
    <i><tt class="parameter">memcache.hash_function</tt></i>

    <a href="language.types.string.html" class="type string">string</a>
   </span>
   <dd>

    <p class="para">
     キーをサーバに関連づける際に使用するハッシュ関数を制御します。
     <i class="literal">crc32</i> は標準の CRC32 ハッシュを、そして
     <i class="literal">fnv</i> は FNV-1a を使用します。
    </p>
   </dd>

  </dt>


  <dt id="ini.memcache.session-handler">
   <span class="term">
    <i><tt class="parameter">session.save_handler</tt></i>

    <a href="language.types.string.html" class="type string">string</a>
   </span>
   <dd>

    <p class="para">
     memcache をセッションハンドラとして使用するには、この値を
     <i class="literal">memcache</i> と設定します。
    </p>
   </dd>

  </dt>


  <dt id="ini.memcache.save-path">
   <span class="term">
    <i><tt class="parameter">session.save_path</tt></i>

    <a href="language.types.string.html" class="type string">string</a>
   </span>
   <dd>

    <p class="para">
     セッションを格納するためのサーバの URL を、カンマ区切りで指定します。たとえば
     <i class="literal">&quot;tcp://host1:11211, tcp://host2:11211&quot;</i> のようになります。
    </p>
    <p class="para">
     個々の URL には、そのサーバ用のパラメータを含めることができます。これは
     <b>Memcache::addServer()</b> メソッドと同じ形式です。たとえば
     <i class="literal">&quot;tcp://host1:11211?persistent=1&amp;weight=1&amp;timeout=1&amp;retry_interval=15&quot;</i>
     のようになります。
    </p>
   </dd>

  </dt>


 </dl>

</p>
</div>




   <div id="memcache.resources" class="section">
    <h2 class="title">リソース型</h2>
    <p class="para">
     memcache モジュールで使用されるリソースは 1 種類で、それは
     キャッシュサーバとの接続を指す ID です。
    </p>
   </div>

   


<div id="memcache.constants" class="section">
 <h2 class="title">定義済み定数</h2>
 <table border="5">
  <caption><b>Memcache 定数</b></caption>
   <colgroup>

    <thead valign="middle">
     <tr valign="middle">
      <th colspan="1">名前</th>
      <th colspan="1">説明</th>
     </tr>

    </thead>

    <tbody valign="middle">
     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">
       <b><tt>MEMCACHE_COMPRESSED</tt></b>
       (<a href="language.types.integer.html" class="type integer">integer</a>)
      </td>
      <td colspan="1" rowspan="1" align="left">
       <b>Memcache::set()</b>、
       <b>Memcache::add()</b> そして
       <b>Memcache::replace()</b>
       を実行する際に、同時にデータの圧縮を行います。
      </td>
     </tr>

     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left">
       <b><tt>MEMCACHE_HAVE_SESSION</tt></b>
       (<a href="language.types.integer.html" class="type integer">integer</a>)
      </td>
      <td colspan="1" rowspan="1" align="left">
       この Memcache セッションハンドラが有効な場合に 1、それ以外の場合に 0 となります。
      </td>
     </tr>

    </tbody>
   </colgroup>

  </table>

</div>




   <div id="memcache.examples" class="section">
   <h2 class="title">例</h2>
    <p class="para">
     <div class="example">
      <p><b>Example#1 memcache 拡張モジュールの概要</b></p>
      <div class="example-contents"><p>
       この例では、オブジェクトをキャッシュに保存した後に、改めて取得しなおします。
       オブジェクトやその他の非スカラー型のデータは、保存される前に
       シリアライズされます。そのため (接続 ID などの) リソース型を
       保存することはできません。
      </p></div>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$memcache&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Memcache</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$memcache</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">11211</span><span style="color: #007700">)&nbsp;or&nbsp;die&nbsp;(</span><span style="color: #DD0000">"接続できませんでした"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$version&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$memcache</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getVersion</span><span style="color: #007700">();<br />echo&nbsp;</span><span style="color: #DD0000">"サーバのバージョン:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$version</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;br/&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$tmp_object&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">stdClass</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$tmp_object</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">str_attr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$tmp_object</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">int_attr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">123</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$memcache</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set</span><span style="color: #007700">(</span><span style="color: #DD0000">'key'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tmp_object</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">)&nbsp;or&nbsp;die&nbsp;(</span><span style="color: #DD0000">"データをサーバに保存できませんでした"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"データをキャッシュに保存します&nbsp;(データの有効期限は&nbsp;10&nbsp;秒です)&lt;br/&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$get_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$memcache</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'key'</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"キャッシュから取得したデータ:&lt;br/&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$get_result</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
    <p class="para">
     <div class="example">
      <p><b>Example#2 memcache セッションハンドラの使用例</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$session_save_path&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"tcp://$host:$port?persistent=1&amp;weight=2&amp;timeout=2&amp;retry_interval=10,&nbsp;&nbsp;,tcp://$host:$port&nbsp;&nbsp;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.save_handler'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'memcache'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.save_path'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$session_save_path</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
   </div>

  </div>

  






































































































































 <h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.Memcache-add.html">Memcache::add</a> ― サーバに項目を追加する</li><li><a href="function.Memcache-addServer.html">Memcache::addServer</a> ― コネクションプールに memcached サーバを追加する</li><li><a href="function.Memcache-close.html">Memcache::close</a> ― memcached サーバとの接続を閉じる</li><li><a href="function.Memcache-connect.html">Memcache::connect</a> ― memcached サーバへの接続をオープンする</li><li><a href="function.memcache-debug.html">memcache_debug</a> ― デバッグ出力のオン/オフを切り替える</li><li><a href="function.Memcache-decrement.html">Memcache::decrement</a> ― 項目の値を減らす</li><li><a href="function.Memcache-delete.html">Memcache::delete</a> ― サーバから項目を削除する</li><li><a href="function.Memcache-flush.html">Memcache::flush</a> ― サーバ上のすべての既存項目を消去する</li><li><a href="function.Memcache-get.html">Memcache::get</a> ― サーバから項目を取得する</li><li><a href="function.Memcache-getExtendedStats.html">Memcache::getExtendedStats</a> ― プール内のすべてのサーバの統計情報を取得する</li><li><a href="function.Memcache-getServerStatus.html">Memcache::getServerStatus</a> ― サーバの状態を返す</li><li><a href="function.Memcache-getStats.html">Memcache::getStats</a> ― サーバの統計情報を取得する</li><li><a href="function.Memcache-getVersion.html">Memcache::getVersion</a> ― サーバのバージョンを返す</li><li><a href="function.Memcache-increment.html">Memcache::increment</a> ― 項目の値を増やす</li><li><a href="function.Memcache-pconnect.html">Memcache::pconnect</a> ― memcached サーバへの持続的な接続をオープンする</li><li><a href="function.Memcache-replace.html">Memcache::replace</a> ― 既存項目の値を置換する</li><li><a href="function.Memcache-set.html">Memcache::set</a> ― データをサーバに格納する</li><li><a href="function.Memcache-setCompressThreshold.html">Memcache::setCompressThreshold</a> ― 大きな値に対する自動圧縮処理を有効にする</li><li><a href="function.Memcache-setServerParams.html">Memcache::setServerParams</a> ― サーバのパラメータおよび状態を、実行時に変更する</li></ul>
</div>
<hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.m-verifysslcert.html">m_verifysslcert</a></div>
 <div class="next" style="float: right;"><a href="function.Memcache-add.html">Memcache::add</a></div>
 <div class="up"><a href="funcref.html">関数リファレンス</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
