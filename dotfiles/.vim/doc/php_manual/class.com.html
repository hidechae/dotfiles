<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>COM クラス</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="ref.com.html">COM</a></div>
 <div class="next" style="float: right;"><a href="class.dotnet.html">DOTNET</a></div>
 <div class="up"><a href="ref.com.html">COM</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="class.com" class="refentry">
  <div class="refnamediv">
   <h1 class="refname">COM</h1>
   <p class="verinfo">(No version information available, might be only in CVS)</p><p class="refpurpose">COM ― COM クラス</p>

  </div>
  <div class="refsynopsisdiv">
  <pre class="synopsis">$obj = new <span class="classname">COM</span>(&quot;Application.ID&quot;)</pre>
  </div>
  <div class="refsect1 u">
   <h3 class="title">説明</h3>
   <p class="simpara">
    COM クラスにより、OLE 互換の COM オブジェクトのインスタンスを作成し、
    そのメソッドをコールしたりそのプロパティにアクセスしたりすることが
    可能となります。
   </p>
  </div>

  <div class="refsect1 u">
   <h3 class="title">メソッド</h3>
    <div class="methodsynopsis">
     <span class="type">com</span> <span class="methodname"><b><b>COM::COM</b></b></span>
      ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$module_name</tt></span>
     [, <span class="methodparam"><span class="type">mixed</span> <tt class="parameter">$server_name</tt></span>
     [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$codepage</tt></span>
     [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$typelib</tt></span>
    ]]] )</div>

   <p class="para">
    COM クラスのコンストラクタ。 パラメータには以下のような意味があります。
    <dl>

    <dt>
<span class="term">module_name</span>
    <dd>

     <span class="simpara">
      ロードするコンポーネントを指定する
      プログラム ID、クラス ID またはモニカです。
     </span>
     <span class="simpara">
      プログラムID は、通常、アプリケーションまたは DLL の名前の後に、
      <i class="literal">Word.Application</i> のようにピリオドと
      オブジェクト名を付けたものです。
     </span>
     <span class="simpara">
      クラス ID は、指定されたクラスがユニークに定義する UUID です。
     </span>
     <span class="simpara">
      モニカは、URL スキームの考え方に似た特別な命名形式です。リソースと、
      それがどのように読み込まれるかを指定します。例として、モジュール名に
      Word ドキュメントのフルパスを指定すると、Word を読み込んで
      ドキュメントに対応するオブジェクトを取得することができます。
      あるいは、LDAP への ADSI インターフェースを指すモニカとして
      <i class="literal">LDAP:</i> を使用することが可能です。
     </span>
    </dd>

    </dt>

    <dt>
<span class="term">server_name</span>
    <dd>

     <span class="simpara">
      コンポーネントが読み込んで実行される DCOM サーバの名前です。
      <b><tt>NULL</tt></b> の場合、オブジェクトはアプリケーションのデフォルトを
      指定して実行されます。典型的なデフォルトは、ローカルマシン上で
      実行させることでが、管理者によってはアプリケーションを別の
      マシン上で実行させるように設定しているかもしれません。
     </span>
     <span class="simpara">
      非 <b><tt>NULL</tt></b> 値をサーバに指定した場合、
      <a href="ref.com.html" class="xref">COM</a> 設定オプションが
      <b><tt>TRUE</tt></b> に設定されていない限り PHP はオブジェクトの読み込みを
      拒否します。
     </span>
     <p class="para">
      <i><tt class="parameter">server_name</tt></i>
 が配列の場合、以下の要素
      (大文字小文字を区別します!)を含まなければなりません。
      これらはすべて省略可能であることに注意しましょう
      (とはいえ、Username および Password は両方指定する必要があります)。
      もしサーバ設定を省略した場合は(上で説明した)デフォルトのサーバが
      使用され、オブジェクトの生成は <a href="ref.com.html" class="xref">COM</a>
      ディレクティブの影響を受けません。

      <table border="5">
       <caption><b>DCOM サーバ名</b></caption>
       <colgroup>

        <thead valign="middle">
         <tr valign="middle">
          <th colspan="1"><i><tt class="parameter">server_name</tt></i>
 のキー</th>
          <th colspan="1">型</th>
          <th colspan="1">説明</th>
         </tr>

        </thead>

        <tbody valign="middle">
         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">Server</td>
          <td colspan="1" rowspan="1" align="left">string</td>
          <td colspan="1" rowspan="1" align="left">サーバの名前。</td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">Username</td>
          <td colspan="1" rowspan="1" align="left">string</td>
          <td colspan="1" rowspan="1" align="left">接続するユーザ名。</td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">Password</td>
          <td colspan="1" rowspan="1" align="left">string</td>
          <td colspan="1" rowspan="1" align="left"><i><tt class="parameter">Username</tt></i>
 に対するパスワード。</td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">Flags</td>
          <td colspan="1" rowspan="1" align="left">integer</td>
          <td colspan="1" rowspan="1" align="left">以下の定数のうちのひとつまたは複数の論理和。
           <b><tt>CLSCTX_INPROC_SERVER</tt></b>、
           <b><tt>CLSCTX_INPROC_HANDLER</tt></b>、
           <b><tt>CLSCTX_LOCAL_SERVER</tt></b>、
           <b><tt>CLSCTX_REMOTE_SERVER</tt></b>、
           <b><tt>CLSCTX_SERVER</tt></b> および
           <b><tt>CLSCTX_ALL</tt></b>。指定されていない場合の
           デフォルト値は、<i><tt class="parameter">Server</tt></i>
 を省略した場合が
           <b><tt>CLSCTX_SERVER</tt></b> でサーバ名を指定した場合は
           <b><tt>CLSCTX_REMOTE_SERVER</tt></b> です。
           これらの定数の意味についての詳細な情報を得るには、Microsoft
           のドキュメントで CoCreateInstance について調べましょう。
           通常はこれらを使用する必要はないはずです。
          </td>
         </tr>

        </tbody>
        </colgroup>

       </table>

     </p>
    </dd>

    </dt>

    <dt>
<span class="term">codepage</span>
    <dd>

     <span class="simpara">
      文字列と Unicode 文字列との相互変換に使用するコードページを指定します。
      PHP の文字列と COM オブジェクトのメソッドとの受け渡しの際には、いつも
      変換が行われます。PHP 5 では、コードページの扱いは面倒です。というのは、
      オブジェクトだけではなくオブジェクトから返される variant にもそれが
      影響するからです。
     </span>
     <span class="simpara">
      とりうる値は
      <b><tt>CP_ACP</tt></b> (システムのデフォルト ANSI
      コードページを使用する - このパラメータが指定されなかった場合の
      デフォルト)、
      <b><tt>CP_MACCP</tt></b>、
      <b><tt>CP_OEMCP</tt></b>、<b><tt>CP_SYMBOL</tt></b>、
      <b><tt>CP_THREAD_ACP</tt></b> (現在実行中のスレッドの
      コードページ/ロケールを使用する)、<b><tt>CP_UTF7</tt></b>
      および <b><tt>CP_UTF8</tt></b> です。コードページに対応する
      数値を指定することも可能です。コードページとそれに対応する数値に
      ついての詳細は、Microsoft のドキュメントを参照ください。
     </span>
    </dd>

    </dt>

    </dl>

   </p>
  </div>


  <div class="refsect1 u">
   <h3 class="title">オーバーロードされたメソッド</h3>

   <p class="para">
    返されるオブジェクトは、オーバーロードされたものです。つまり、
    PHP 側では通常のクラスのメソッドは見えないということです。
    その代わりに、プロパティやメソッドへのアクセスは COM を通じて行います。
   </p>

   <p class="para">
    PHP 5 以降では、参照渡しのパラメータを受け付けるメソッドを PHP が
    自動検出するようになりました。それらのメソッドについては、PHP が自動的に
    変数を参照渡し形式に変換します。つまり、メソッドのコールをより自然に
    行えるということです。コードの中で特別な処理をする必要はありません。
   </p>

   <p class="para">
    PHP 4 では、パラメータを参照渡しする場合には、そのパラメータをラップする
    ために <a href="class.variant.html" class="xref">VARIANT</a> クラスのインスタンスを生成する
    必要があります。
   </p>

  </div>

  
  <div class="refsect1 u">
   <h3 class="title">疑似メソッド</h3>
   
   <p class="para">
    PHP 5 より前のバージョンでは、以下のようなメソッド名を COM に渡すことが
    できず、直接 PHP で扱うことができないというあまりうれしくない出来事が
    ありました。PHP 5 ではこれらを解決します。スクリプトの修正方法に
    ついては以下の詳細を参照ください。これらのマジックメソッドの名前は
    大文字小文字を区別しません。
   </p>

    <div class="methodsynopsis">
     <span class="type">void</span> <span class="methodname"><b><a href="function.com-addref.html" class="function">COM::AddRef</a></b></span>
      ( <span class="methodparam">void</span>
     )</div>

    <p class="simpara">COM オブジェクトの参照カウントを作為的に追加します。</p>
    <div class="warning"><b class="warning">警告</b>
     <p class="simpara">
      このメソッドを使用することはまずないはずです。
      これは、以下で説明する Release() メソッドを論理的に補完するものとして
      存在するものです。
     </p>
    </div>
    
    <div class="methodsynopsis">
     <span class="type">void</span> <span class="methodname"><b><a href="function.com-release.html" class="function">COM::Release</a></b></span>
      ( <span class="methodparam">void</span>
     )</div>

    <p class="simpara">COM オブジェクトの参照カウントを作為的に削除します。</p>
    <div class="warning"><b class="warning">警告</b>
     <p class="simpara">
      このメソッドを使用することはまずないはずです。
      これは、COM オブジェクトが必要以上に動作を続けてしまうというバグに
      対応する方法として PHP に存在するものです。
     </p>
    </div>
   </div>

   
   <div class="refsect1 u">
    <h3 class="title">反復処理のための疑似メソッド</h3>
    
    <p class="para">
     以下の疑似メソッドは、 <a href="function.com-isenum.html" class="function">com_isenum()</a> が <b><tt>TRUE</tt></b>
     を返す場合のみ利用可能で、この場合、これらのメソッドは、
     通常は COM オブジェクトにより提供される同じ名前を有する全ての
     メソッドを隠蔽します。これらのメソッドは PHP 5 では完全に廃止されています。
     代わりに <a href="ref.com.html" class="xref">COM</a> を使用してください。
    </p>

    <div class="methodsynopsis">
     <span class="type">variant</span> <span class="methodname"><b><b>COM::All</b></b></span>
      ( <span class="methodparam">void</span>
     )</div>

    <p class="simpara">
     10 の要素を保持する SafeArray を表す variant を返します。
     個々の要素は empty/null の variant となります。この関数は
     イテレータからの全ての要素を含む配列を返すことを想定していますが、
     決して完了しません。使用しないでください。
    </p>

    <div class="methodsynopsis">
     <span class="type">variant</span> <span class="methodname"><b><b>COM::Next</b></b></span>
      ( <span class="methodparam">void</span>
     )</div>

    <p class="simpara">
     イテレータの次の要素を表す variant を返します。要素が
     もうない場合には <b><tt>FALSE</tt></b> を返します。
    </p>

    <div class="methodsynopsis">
     <span class="type">variant</span> <span class="methodname"><b><b>COM::Prev</b></b></span>
      ( <span class="methodparam">void</span>
     )</div>

    <p class="simpara">
     イテレータの前の要素を現す variant を返します。要素が
     もうない場合には <b><tt>FALSE</tt></b> を返します。
    </p>

    <div class="methodsynopsis">
     <span class="type">void</span> <span class="methodname"><b><b>COM::Reset</b></b></span>
      ( <span class="methodparam">void</span>
     )</div>

    <p class="simpara">イテレータを最初の場所まで巻き戻します。</p>
   </div>

   
   <div class="refsect1 u">
    <h3 class="title">COM の例</h3> 
   <p class="para">
    <div class="example">
     <p><b>Example#1 COM の例 (1)</b></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;word&nbsp;を起動します<br /></span><span style="color: #0000BB">$word&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">COM</span><span style="color: #007700">(</span><span style="color: #DD0000">"word.application"</span><span style="color: #007700">)&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;instantiate&nbsp;Word"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Loaded&nbsp;Word,&nbsp;version&nbsp;{$word-&gt;Version}\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;前面に移動させます<br /></span><span style="color: #0000BB">$word</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Visible&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;空のドキュメントを開きます<br /></span><span style="color: #0000BB">$word</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Documents</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Add</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;何か複雑なことを行います<br /></span><span style="color: #0000BB">$word</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Selection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">TypeText</span><span style="color: #007700">(</span><span style="color: #DD0000">"This&nbsp;is&nbsp;a&nbsp;test..."</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$word</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Documents</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">SaveAs</span><span style="color: #007700">(</span><span style="color: #DD0000">"Useless&nbsp;test.doc"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;word&nbsp;を閉じます<br /></span><span style="color: #0000BB">$word</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Quit</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;オブジェクトを開放します<br /></span><span style="color: #0000BB">$word&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
   <p class="para">
    <div class="example">
     <p><b>Example#2 COM の例 (2)</b></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">COM</span><span style="color: #007700">(</span><span style="color: #DD0000">"ADODB.Connection"</span><span style="color: #007700">)&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"Cannot&nbsp;start&nbsp;ADO"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Open</span><span style="color: #007700">(</span><span style="color: #DD0000">"Provider=SQLOLEDB;&nbsp;Data&nbsp;Source=localhost;<br />Initial&nbsp;Catalog=database;&nbsp;User&nbsp;ID=user;&nbsp;Password=password"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$rs&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Execute</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;sometable"</span><span style="color: #007700">);&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Recordset<br /><br /></span><span style="color: #0000BB">$num_columns&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Fields</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Count</span><span style="color: #007700">();<br />echo&nbsp;</span><span style="color: #0000BB">$num_columns&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br />for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$num_columns</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$fld</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$rs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Fields</span><span style="color: #007700">(</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$rowcount&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />while&nbsp;(!</span><span style="color: #0000BB">$rs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">EOF</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$num_columns</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$fld</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">value&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\t"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rowcount</span><span style="color: #007700">++;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;行カウントの加算<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">MoveNext</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #0000BB">$rs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Close</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Close</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$rs&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
  </div>

 </div><hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="ref.com.html">COM</a></div>
 <div class="next" style="float: right;"><a href="class.dotnet.html">DOTNET</a></div>
 <div class="up"><a href="ref.com.html">COM</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
